// ===== GIS Data: Regional Office Boundaries & Dynamic Mapping =====
// Oblast-level GeoJSON for real administrative borders.
// Office→oblast mapping is loaded from DB via state-gis.js.
// Fallback constants are used when DB table is not yet created.

import { regionalOffices } from './state-gis.js';

// ===== Ukraine oblasts GeoJSON (25 oblasts, simplified 8%) =====
const OBLASTS_RAW = {"type":"FeatureCollection","features":[{"type":"Feature","properties":{"name":"Крим"},"geometry":{"type":"MultiPolygon","coordinates":[[[[34.4746,45.9466],[34.0199,46.1003],[33.8761,46.0896],[33.6143,46.226],[33.6152,46.1346],[33.6319,45.9828],[33.3507,45.784],[32.9085,45.6396],[32.5836,45.4796],[32.4936,45.3468],[32.65,45.3147],[32.9085,45.3615],[33.2592,45.1475],[33.391,45.1971],[33.5125,45.1335],[33.602,44.9993],[33.5845,44.8086],[33.6817,44.7702],[33.7764,44.6902],[33.8989,44.4238],[34.128,44.4286],[34.3486,44.5493],[34.4571,44.7103],[34.7275,44.8118],[35.1577,44.8955],[35.4249,45.0136],[35.5846,45.1301],[35.8405,44.9979],[36.0279,45.0497],[36.2219,45.0279],[36.4065,45.0706],[36.4177,45.2862],[36.6088,45.4081],[36.3449,45.4831],[36.125,45.4618],[35.9746,45.3701],[35.8453,45.4463],[35.7188,45.334],[35.5252,45.2827],[35.3056,45.4093],[34.9644,45.7588],[35.0052,45.6805],[35.3061,45.3879],[35.2046,45.3406],[34.9806,45.3593],[35.0975,45.4935],[35.0274,45.6388],[34.6588,45.8009],[34.6485,45.9447],[34.4746,45.9466]]],[[[33.6817,44.7702],[33.534,44.7911],[33.5982,44.5033],[33.7366,44.3877],[33.8989,44.4238],[33.7764,44.6902],[33.6817,44.7702]]]]}},{"type":"Feature","properties":{"name":"Вінницька"},"geometry":{"type":"Polygon","coordinates":[[[29.4311,49.6625],[29.2126,49.5882],[28.9922,49.5965],[28.9016,49.8618],[28.3805,49.7807],[27.835,49.7565],[27.8348,49.7289],[27.7318,49.4957],[27.8505,49.4287],[27.8538,49.1716],[27.6407,49.1677],[27.5973,49.1344],[27.4386,49.0702],[27.3832,49.0076],[27.4283,48.7946],[27.4129,48.7403],[27.3728,48.6294],[27.4557,48.5912],[27.5346,48.4702],[27.746,48.4576],[28.0888,48.2343],[28.3533,48.2459],[28.4219,48.1219],[28.5772,48.1821],[28.8666,48.07],[29.0647,48.194],[29.3124,48.0864],[29.6642,48.1079],[29.6556,48.1938],[29.7735,48.2718],[29.8633,48.4266],[29.9672,48.4906],[30.0068,48.5134],[30.0204,48.5196],[30.0049,48.5721],[29.9863,48.6119],[29.9448,48.6568],[29.6518,48.9365],[29.7038,49.2243],[29.7089,49.2626],[29.5356,49.3247],[29.5051,49.395],[29.5369,49.6359],[29.4311,49.6625]]]}},{"type":"Feature","properties":{"name":"Волинська"},"geometry":{"type":"Polygon","coordinates":[[[25.6311,51.9016],[25.2616,51.9671],[24.9642,51.8973],[24.3732,51.8786],[24.3175,51.7494],[23.9954,51.5804],[23.6799,51.6528],[23.7022,51.4191],[23.6383,51.332],[23.8705,51.1509],[23.9154,51.0077],[24.1045,50.8381],[23.9584,50.7947],[24.1538,50.6461],[24.3115,50.5713],[24.5294,50.5527],[24.7777,50.3376],[25.0603,50.3426],[25.1007,50.3003],[25.1669,50.3302],[25.1597,50.5077],[25.2915,50.6315],[25.6014,50.6965],[25.8241,50.6461],[25.9062,50.8307],[26.0234,50.82],[25.9898,50.8672],[26.0835,50.9729],[26.0179,51.083],[25.9983,51.2269],[25.6433,51.4181],[25.5632,51.5409],[25.6797,51.7554],[25.6311,51.9016]]]}},{"type":"Feature","properties":{"name":"Дніпропетровська"},"geometry":{"type":"Polygon","coordinates":[[[35.0554,49.1754],[35.0441,49.1563],[35.0126,49.1492],[34.9487,49.1928],[34.9024,49.1509],[34.7659,49.1431],[34.574,49.0961],[34.3276,48.9997],[34.3127,48.741],[34.2866,48.7435],[34.1258,48.7854],[34.0746,48.8237],[33.9272,48.88],[33.8919,48.903],[33.8483,48.7715],[33.8096,48.8029],[33.5823,48.7967],[33.7504,48.6814],[33.8004,48.6619],[33.7615,48.625],[33.6586,48.5863],[33.4721,48.5457],[33.4707,48.3257],[33.5464,48.2375],[33.1442,48.0662],[33.1095,48.0442],[33.0379,48.0349],[33.0774,47.9204],[33.0819,47.8349],[33.0566,47.832],[33.0498,47.7819],[32.9928,47.623],[33.0953,47.597],[33.0929,47.5793],[33.1716,47.5668],[33.2791,47.5181],[33.5789,47.5989],[33.6076,47.5609],[33.6361,47.5129],[33.9352,47.5168],[34.1394,47.4768],[34.6541,47.5594],[34.8777,47.5148],[34.9654,47.5501],[34.9561,47.7127],[34.9576,47.7698],[34.8635,47.8799],[34.8751,48.0545],[35.1009,48.1306],[35.4197,48.1008],[35.7046,48.1407],[35.8169,48.0658],[35.9848,48.0851],[35.9878,48.0589],[36.0844,47.9303],[36.2765,47.8154],[36.3324,47.8206],[36.4563,47.824],[36.5848,47.8475],[36.5899,48.0004],[36.5904,48.0202],[36.5752,48.0399],[36.6553,48.0993],[36.854,48.0323],[36.9365,48.1941],[36.8171,48.3122],[36.83,48.4847],[36.7466,48.5968],[36.7398,48.6264],[36.5917,48.6023],[36.4823,48.6629],[36.356,48.5323],[36.0205,48.8543],[35.9893,48.9701],[35.7519,48.9469],[35.4864,48.972],[35.2571,49.1127],[35.0554,49.1754]]]}},{"type":"Feature","properties":{"name":"Донецька"},"geometry":{"type":"Polygon","coordinates":[[[37.9355,49.1917],[37.8421,49.2019],[37.6206,49.2329],[37.5845,49.1246],[37.3842,49.0487],[37.1921,48.8151],[36.968,48.7934],[36.8545,48.8004],[36.711,48.6936],[36.7466,48.5968],[36.83,48.4847],[36.8171,48.3122],[36.9365,48.1941],[36.854,48.0323],[36.6553,48.0993],[36.5752,48.0399],[36.5904,48.0202],[36.5899,48.0004],[36.5848,47.8475],[36.6052,47.851],[36.7466,47.6064],[37.0234,47.5511],[37.1949,47.373],[36.9271,47.3195],[36.9481,47.1597],[37.14,46.9822],[37.0624,46.8826],[37.2378,46.95],[37.3361,46.8891],[37.52,47.0714],[37.8904,47.1111],[38.2303,47.1193],[38.2208,47.3054],[38.3028,47.3915],[38.2851,47.5439],[38.3503,47.617],[38.7725,47.6856],[38.8795,47.8763],[39.0736,47.8694],[39.0401,48.0069],[38.8369,48.014],[38.8199,48.1157],[38.6056,48.1715],[38.5594,48.2744],[38.2896,48.4761],[38.314,48.6843],[38.1331,48.926],[38.0394,49.1266],[37.9355,49.1917]]]}},{"type":"Feature","properties":{"name":"Житомирська"},"geometry":{"type":"Polygon","coordinates":[[[29.3935,51.3799],[29.1169,51.6567],[28.9979,51.5739],[28.6395,51.554],[28.3434,51.5763],[28.1712,51.6447],[27.7596,51.4728],[27.6693,51.4969],[27.5801,51.478],[27.4414,51.311],[27.2569,50.8956],[27.2449,50.6742],[27.2106,50.6384],[27.2326,50.5664],[27.2067,50.5321],[27.2585,50.5144],[27.3015,50.4932],[27.2488,50.3932],[27.6646,50.1941],[27.6103,49.8762],[27.6685,49.8077],[27.7272,49.7994],[27.7032,49.7694],[27.835,49.7565],[28.3805,49.7807],[28.9016,49.8618],[28.9922,49.5965],[29.2126,49.5882],[29.4311,49.6625],[29.4878,49.67],[29.4384,49.8054],[29.667,49.8746],[29.7296,49.9686],[29.6432,50.18],[29.7003,50.2318],[29.5599,50.4232],[29.4977,50.5887],[29.5773,50.6998],[29.5215,50.869],[29.4131,50.9853],[29.5111,51.0605],[29.3494,51.16],[29.3935,51.3799]]]}},{"type":"Feature","properties":{"name":"Закарпатська"},"geometry":{"type":"Polygon","coordinates":[[[22.8965,49.0052],[22.5525,49.0797],[22.3799,48.8603],[22.339,48.6842],[22.1887,48.61],[22.2103,48.4259],[22.3809,48.2355],[22.5015,48.2487],[22.6727,48.0917],[22.8246,48.1175],[22.9492,47.9686],[23.114,48.0864],[23.4509,47.9765],[23.5292,48.0202],[24.0093,47.967],[24.2274,47.8965],[24.5534,47.9593],[24.5782,48.0196],[24.5475,48.2161],[24.2905,48.3817],[24.1833,48.3655],[24.1459,48.4344],[24.1421,48.4809],[24.1154,48.4976],[24.0328,48.5017],[23.9639,48.459],[23.9071,48.4831],[23.9293,48.552],[23.8358,48.5791],[23.7877,48.64],[23.6386,48.6846],[23.3965,48.7354],[23.2029,48.7603],[23.0998,48.8624],[22.9681,48.8769],[22.8747,48.9573],[22.8965,49.0052]]]}},{"type":"Feature","properties":{"name":"Запорізька"},"geometry":{"type":"Polygon","coordinates":[[[35.4197,48.1008],[35.1009,48.1306],[34.8751,48.0545],[34.8635,47.8799],[34.9576,47.7698],[34.9561,47.7127],[34.9654,47.5501],[34.8777,47.5148],[34.6541,47.5594],[34.1394,47.4768],[34.2364,47.4416],[34.3301,47.2904],[34.4799,47.3145],[34.5201,47.105],[34.6234,46.9727],[34.7364,46.9611],[34.7578,46.8229],[34.7127,46.6196],[35.0536,46.4819],[35.1038,46.302],[35.2686,46.2503],[35.4529,46.4386],[35.9319,46.6615],[36.2514,46.6364],[36.413,46.7251],[36.6284,46.7804],[36.8147,46.7326],[37.0624,46.8826],[37.14,46.9822],[36.9481,47.1597],[36.9271,47.3195],[37.1949,47.373],[37.0234,47.5511],[36.7466,47.6064],[36.6052,47.851],[36.4563,47.824],[36.3324,47.8206],[36.2765,47.8154],[36.0844,47.9303],[35.9878,48.0589],[35.9848,48.0851],[35.8169,48.0658],[35.7046,48.1407],[35.4197,48.1008]]]}},{"type":"Feature","properties":{"name":"Івано-Франківська"},"geometry":{"type":"Polygon","coordinates":[[[24.5218,49.5417],[24.4344,49.5359],[24.4111,49.4449],[24.388,49.396],[24.3585,49.3229],[24.3069,49.2762],[24.4156,49.1677],[24.2315,49.1441],[23.9049,49.0997],[23.7196,49.0943],[23.6722,49.0353],[23.5651,48.9741],[23.5472,48.7264],[23.6386,48.6846],[23.7877,48.64],[23.8358,48.5791],[23.9293,48.552],[23.9071,48.4831],[23.9639,48.459],[24.0328,48.5017],[24.1154,48.4976],[24.1421,48.4809],[24.1459,48.4344],[24.1833,48.3655],[24.2905,48.3817],[24.5475,48.2161],[24.5782,48.0196],[24.7062,47.8398],[24.9215,47.7262],[24.997,47.8538],[24.918,47.9485],[24.9117,48.0282],[25.0355,48.1117],[25.1077,48.2249],[25.3189,48.3684],[25.601,48.4118],[25.5841,48.6307],[25.6525,48.703],[25.5562,48.7981],[25.246,48.8676],[24.9021,49.0496],[24.9174,49.0823],[24.8608,49.3475],[24.7714,49.4321],[24.7211,49.4968],[24.5218,49.5417]]]}},{"type":"Feature","properties":{"name":"Кіровоградська"},"geometry":{"type":"Polygon","coordinates":[[[32.9287,49.2331],[32.8894,49.1203],[32.8423,49.0273],[32.7329,48.9655],[32.7302,48.9777],[32.6805,48.957],[32.6061,48.9639],[32.582,48.9506],[32.5508,48.94],[32.5009,49.0146],[32.2834,49.0856],[32.2189,48.9887],[31.9175,48.9071],[31.806,48.9495],[31.5821,48.8872],[31.4122,48.756],[31.1152,48.7283],[30.8849,48.7455],[30.6985,48.7667],[30.5551,48.6545],[30.5712,48.6064],[30.387,48.5282],[30.1649,48.5038],[30.0444,48.4822],[29.8633,48.4266],[29.7735,48.2718],[29.8925,48.1835],[30.0092,48.2086],[30.0035,48.1842],[30.0329,48.179],[30.0494,48.1515],[30.1051,48.1402],[30.1873,48.1539],[30.3178,48.1411],[30.4998,48.1698],[31.1631,48.2226],[31.2361,48.1166],[31.766,48.103],[31.8441,47.9615],[31.8277,47.8171],[32.0568,47.8182],[32.1155,47.7555],[32.6577,47.8194],[32.6903,47.9816],[32.8938,47.9854],[32.9905,48.0489],[33.0379,48.0349],[33.1095,48.0442],[33.1442,48.0662],[33.5464,48.2375],[33.4707,48.3257],[33.4721,48.5457],[33.6586,48.5863],[33.7615,48.625],[33.8004,48.6619],[33.7504,48.6814],[33.5823,48.7967],[33.8096,48.8029],[33.8483,48.7715],[33.8919,48.903],[33.8085,48.9383],[33.7089,48.9412],[33.5725,48.9117],[33.3265,48.9608],[33.1079,49.1819],[32.9916,49.2042],[32.9287,49.2331]]]}},{"type":"Feature","properties":{"name":"Луганська"},"geometry":{"type":"Polygon","coordinates":[[[39.0736,47.8694],[39.3586,47.8726],[39.5212,47.8258],[39.7382,47.8279],[39.8837,48.0412],[39.9468,48.3541],[39.854,48.5629],[39.6893,48.5863],[39.7043,48.7207],[39.8524,48.8905],[39.6925,49.0504],[39.9381,49.0563],[40.2003,49.346],[40.0295,49.4536],[40.1357,49.6165],[39.806,49.558],[39.5913,49.7183],[39.2853,49.7554],[39.1792,49.8884],[38.9309,49.7969],[38.5826,49.9774],[38.3506,50.0064],[38.0457,49.9155],[38.0936,49.8465],[37.9506,49.7305],[38.0468,49.6576],[37.8426,49.508],[37.958,49.2846],[37.8992,49.2696],[37.8675,49.2464],[37.9355,49.1917],[38.0394,49.1266],[38.1331,48.926],[38.314,48.6843],[38.2896,48.4761],[38.5594,48.2744],[38.6056,48.1715],[38.8199,48.1157],[38.8369,48.014],[39.0401,48.0069],[39.0736,47.8694]]]}},{"type":"Feature","properties":{"name":"Львівська"},"geometry":{"type":"Polygon","coordinates":[[[24.1538,50.6461],[23.996,50.412],[23.6978,50.371],[23.581,50.2655],[23.2797,50.1009],[22.6411,49.5302],[22.7466,49.361],[22.7464,49.2161],[22.8965,49.0052],[22.8747,48.9573],[22.9681,48.8769],[23.0998,48.8624],[23.2029,48.7603],[23.3965,48.7354],[23.5472,48.7264],[23.5651,48.9741],[23.6722,49.0353],[23.7196,49.0943],[23.9049,49.0997],[24.2315,49.1441],[24.4156,49.1677],[24.3069,49.2762],[24.3585,49.3229],[24.388,49.396],[24.4111,49.4449],[24.4344,49.5359],[24.5218,49.5417],[24.7211,49.4968],[24.7187,49.5708],[24.8333,49.5989],[24.9399,49.6079],[24.9662,49.6409],[25.0223,49.7354],[25.0673,49.7116],[25.0752,49.77],[25.3758,49.8683],[25.4023,49.9854],[25.3108,50.0246],[25.197,50.1307],[25.2154,50.1802],[25.1914,50.2488],[25.2066,50.2798],[25.0575,50.3002],[25.0603,50.3426],[24.7777,50.3376],[24.5294,50.5527],[24.3115,50.5713],[24.1538,50.6461]]]}},{"type":"Feature","properties":{"name":"Миколаївська"},"geometry":{"type":"Polygon","coordinates":[[[31.8277,47.8171],[31.8441,47.9615],[31.766,48.103],[31.2361,48.1166],[31.1631,48.2226],[30.4998,48.1698],[30.3669,48.1743],[30.3073,48.1419],[30.3133,48.1163],[30.208,48.0669],[30.3309,47.8098],[30.4711,47.617],[30.7888,47.6488],[30.9079,47.2764],[31.1567,47.1816],[31.3017,47.0822],[31.2432,46.9915],[31.0866,46.9821],[31.196,46.6576],[31.3513,46.6012],[31.7958,46.6087],[31.9822,46.6565],[32.2506,46.8193],[32.6901,46.8628],[33.0236,46.9718],[33.0704,47.0209],[32.917,47.1429],[33.1306,47.2031],[33.0404,47.3802],[33.0332,47.4416],[33.149,47.5147],[33.0956,47.5276],[33.0953,47.597],[32.9928,47.623],[33.0498,47.7819],[33.0566,47.832],[33.0819,47.8349],[33.0774,47.9204],[32.9905,48.0489],[32.8938,47.9854],[32.6903,47.9816],[32.6577,47.8194],[32.1155,47.7555],[32.0568,47.8182],[31.8277,47.8171]]]}},{"type":"Feature","properties":{"name":"Одеська"},"geometry":{"type":"Polygon","coordinates":[[[30.0092,48.2086],[29.8925,48.1835],[29.6556,48.1938],[29.6642,48.1079],[29.3124,48.0864],[29.0647,48.194],[28.8666,48.07],[28.9259,47.9599],[29.175,47.9937],[29.2764,47.8019],[29.1844,47.5719],[29.3983,47.3003],[29.5518,47.2514],[29.612,47.1003],[29.5958,46.9636],[29.7499,46.861],[29.8834,46.8514],[29.9742,46.7539],[29.9452,46.5551],[30.0218,46.3829],[29.5659,46.4164],[29.448,46.4985],[29.2652,46.4065],[29.1635,46.5155],[28.9307,46.4577],[29.067,46.1955],[28.9503,46.0937],[28.9787,46.0035],[28.7566,45.9573],[28.7858,45.8323],[28.5195,45.7368],[28.5151,45.4999],[28.3045,45.547],[28.2149,45.4707],[28.3496,45.3199],[28.7146,45.2237],[28.798,45.3352],[28.9669,45.3314],[29.2423,45.4341],[29.4283,45.4433],[29.5943,45.3871],[29.7438,45.2307],[29.7659,45.4625],[29.7122,45.5754],[30.2339,45.8712],[30.4812,46.0791],[30.7716,46.4479],[30.7292,46.5087],[31.196,46.6576],[31.0866,46.9821],[31.2432,46.9915],[31.3017,47.0822],[31.1567,47.1816],[30.9079,47.2764],[30.7888,47.6488],[30.4711,47.617],[30.3309,47.8098],[30.208,48.0669],[30.3133,48.1163],[30.3073,48.1419],[30.2665,48.1475],[30.0662,48.1458],[30.0234,48.1849],[30.0092,48.2086]]]}},{"type":"Feature","properties":{"name":"Полтавська"},"geometry":{"type":"Polygon","coordinates":[[[33.3183,50.5206],[33.2207,50.5037],[33.117,50.5056],[33.0237,50.5013],[32.9179,50.4088],[32.5251,50.3452],[32.3291,50.4269],[32.144,50.3485],[32.1304,50.316],[32.0904,50.2467],[32.1256,50.2247],[32.4278,49.9599],[32.3729,49.8744],[32.5735,49.7028],[32.7147,49.6192],[32.6723,49.4468],[32.6792,49.4267],[32.5102,49.4086],[32.4785,49.3414],[32.5979,49.275],[32.7653,49.2319],[32.9287,49.2331],[32.9916,49.2042],[33.1079,49.1819],[33.3265,48.9608],[33.5725,48.9117],[33.7089,48.9412],[33.8233,48.9348],[33.9272,48.88],[34.0746,48.8237],[34.1258,48.7854],[34.2866,48.7435],[34.3127,48.741],[34.3276,48.9997],[34.574,49.0961],[34.7659,49.1431],[34.9024,49.1509],[34.9262,49.1829],[34.9555,49.1926],[35.0181,49.1502],[34.9817,49.2487],[35.2786,49.3178],[35.4813,49.4844],[35.4292,49.5265],[35.3436,49.6661],[35.2436,49.6959],[35.2412,49.7133],[35.2652,49.7154],[35.2066,49.7562],[35.2186,49.8308],[34.9655,49.8864],[34.8539,49.9876],[34.9567,50.0927],[34.9395,50.1517],[34.7497,50.158],[34.6994,50.1492],[34.6768,50.1338],[34.5459,50.1326],[34.5712,50.2265],[34.2586,50.4333],[34.2195,50.5334],[33.9535,50.5484],[33.734,50.4582],[33.3183,50.5206]]]}},{"type":"Feature","properties":{"name":"Рівненська"},"geometry":{"type":"Polygon","coordinates":[[[27.6693,51.4969],[27.7228,51.6035],[27.2409,51.6021],[27.2008,51.7733],[26.949,51.7352],[26.5928,51.8297],[26.1552,51.8662],[25.9976,51.9333],[25.6311,51.9016],[25.6797,51.7554],[25.5632,51.5409],[25.6433,51.4181],[25.9983,51.2269],[26.0179,51.083],[26.0835,50.9729],[25.9898,50.8672],[26.0234,50.82],[25.9062,50.8307],[25.8241,50.6461],[25.6014,50.6965],[25.2915,50.6315],[25.1597,50.5077],[25.1669,50.3302],[25.1007,50.3003],[25.2066,50.2798],[25.1914,50.2488],[25.2154,50.1802],[25.2016,50.1674],[25.2069,50.1195],[25.3488,50.0039],[25.3644,50.047],[25.7284,50.1875],[25.856,50.1903],[25.9245,50.2563],[26.1795,50.1974],[26.2882,50.1814],[26.6491,50.3651],[26.7864,50.4685],[26.8178,50.5029],[26.8553,50.5092],[27.0795,50.5832],[27.2326,50.5664],[27.2106,50.6384],[27.2449,50.6742],[27.2569,50.8956],[27.4414,51.311],[27.5801,51.478],[27.6693,51.4969]]]}},{"type":"Feature","properties":{"name":"Сумська"},"geometry":{"type":"Polygon","coordinates":[[[35.6931,50.3454],[35.4363,50.5302],[35.3945,50.6511],[35.4096,51.039],[35.2098,51.0464],[34.9799,51.2353],[34.7169,51.1717],[34.6617,51.2474],[34.2377,51.2919],[34.2912,51.4803],[34.1278,51.6892],[34.4223,51.7223],[34.4154,51.8253],[34.0625,52.0735],[34.116,52.1411],[33.8389,52.3585],[33.5607,52.3019],[33.4289,52.3457],[33.388,52.315],[33.3772,52.2763],[33.3571,52.2578],[33.3167,52.0314],[33.3951,51.9551],[33.1242,51.863],[33.078,51.7752],[33.1921,51.5068],[33.07,51.2553],[32.9446,51.0915],[33.0421,50.9914],[33.2005,50.9621],[33.1232,50.5945],[33.0491,50.5407],[33.117,50.5056],[33.2207,50.5037],[33.3183,50.5206],[33.734,50.4582],[33.9535,50.5484],[34.2195,50.5334],[34.2586,50.4333],[34.5712,50.2265],[34.5459,50.1326],[34.6768,50.1338],[34.6994,50.1492],[34.7497,50.158],[34.9395,50.1517],[35.33,50.3186],[35.6509,50.3096],[35.6931,50.3454]]]}},{"type":"Feature","properties":{"name":"Тернопільська"},"geometry":{"type":"Polygon","coordinates":[[[26.1795,50.1974],[25.9245,50.2563],[25.856,50.1903],[25.7284,50.1875],[25.3644,50.047],[25.3521,50.0178],[25.3488,50.0039],[25.4023,49.9854],[25.3758,49.8683],[25.0752,49.77],[25.0673,49.7116],[25.0223,49.7354],[24.9662,49.6409],[24.9399,49.6079],[24.8333,49.5989],[24.7187,49.5708],[24.7714,49.4321],[24.8608,49.3475],[24.9174,49.0823],[24.9021,49.0496],[25.246,48.8676],[25.5562,48.7981],[25.6525,48.703],[25.7117,48.6635],[25.7827,48.6754],[25.8497,48.5976],[26.0327,48.643],[26.0449,48.5848],[26.0967,48.5995],[26.271,48.5394],[26.3909,48.5344],[26.3826,48.5636],[26.3098,48.6547],[26.2788,48.6698],[26.2444,48.7342],[26.2086,48.7964],[26.2265,48.8119],[26.2367,48.8184],[26.2061,48.896],[26.213,48.9839],[26.1852,49.0536],[26.2155,49.0704],[26.2047,49.1332],[26.1895,49.1724],[26.258,49.2623],[26.1857,49.4837],[26.243,49.7451],[26.1773,49.8464],[26.2111,50.0165],[26.2267,50.0461],[26.2198,50.1809],[26.1795,50.1974]]]}},{"type":"Feature","properties":{"name":"Харківська"},"geometry":{"type":"Polygon","coordinates":[[[38.0936,49.8465],[37.9265,50.0338],[37.6409,50.1758],[37.4615,50.4187],[37.3332,50.4371],[37.1531,50.3562],[36.8718,50.3353],[36.6883,50.267],[36.3641,50.2874],[36.1479,50.4352],[35.8318,50.4339],[35.6931,50.3454],[35.6509,50.3096],[35.33,50.3186],[34.9395,50.1517],[34.9567,50.0927],[34.8539,49.9876],[34.9655,49.8864],[35.2186,49.8308],[35.2066,49.7562],[35.2652,49.7154],[35.2412,49.7133],[35.2436,49.6959],[35.3436,49.6661],[35.4292,49.5265],[35.4813,49.4844],[35.2786,49.3178],[34.9817,49.2487],[35.0181,49.1502],[35.0554,49.1754],[35.2571,49.1127],[35.4864,48.972],[35.7519,48.9469],[35.9893,48.9701],[36.0205,48.8543],[36.356,48.5323],[36.4823,48.6629],[36.5917,48.6023],[36.7398,48.6264],[36.711,48.6936],[36.8545,48.8004],[36.968,48.7934],[37.1921,48.8151],[37.3842,49.0487],[37.5845,49.1246],[37.6206,49.2329],[37.8421,49.2019],[37.8675,49.2464],[37.8992,49.2696],[37.958,49.2846],[37.8426,49.508],[38.0468,49.6576],[37.9506,49.7305],[38.0936,49.8465]]]}},{"type":"Feature","properties":{"name":"Хмельницька"},"geometry":{"type":"Polygon","coordinates":[[[27.2067,50.5321],[27.0795,50.5832],[26.8553,50.5092],[26.8178,50.5029],[26.7864,50.4685],[26.6491,50.3651],[26.2882,50.1814],[26.2198,50.1809],[26.2267,50.0461],[26.2111,50.0165],[26.1773,49.8464],[26.243,49.7451],[26.1857,49.4837],[26.258,49.2623],[26.1895,49.1724],[26.2047,49.1332],[26.2155,49.0704],[26.1852,49.0536],[26.213,48.9839],[26.2061,48.896],[26.2367,48.8184],[26.2265,48.8119],[26.2086,48.7964],[26.2444,48.7342],[26.2788,48.6698],[26.3098,48.6547],[26.3826,48.5636],[26.6269,48.4623],[26.6556,48.4859],[26.6748,48.5403],[26.7779,48.5939],[26.8251,48.6051],[27.0037,48.5692],[27.1665,48.5821],[27.254,48.5677],[27.2612,48.5838],[27.2384,48.6119],[27.2545,48.6254],[27.334,48.604],[27.3529,48.6291],[27.3728,48.6294],[27.4129,48.7403],[27.4283,48.7946],[27.3832,49.0076],[27.4386,49.0702],[27.5973,49.1344],[27.6407,49.1677],[27.8538,49.1716],[27.8505,49.4287],[27.7318,49.4957],[27.8348,49.7289],[27.7032,49.7694],[27.7272,49.7994],[27.6685,49.8077],[27.6103,49.8762],[27.6646,50.1941],[27.2488,50.3932],[27.3015,50.4932],[27.2585,50.5144],[27.2067,50.5321]]]}},{"type":"Feature","properties":{"name":"Черкаська"},"geometry":{"type":"Polygon","coordinates":[[[32.1256,50.2247],[32.0868,50.2222],[31.9112,50.1015],[31.716,49.8502],[31.3808,49.9072],[31.2071,49.8498],[31.2209,49.7335],[31.0946,49.4978],[30.9092,49.3591],[30.6059,49.3708],[30.4123,49.3301],[30.3679,49.2557],[30.0267,49.332],[29.877,49.2004],[29.7546,49.2267],[29.7038,49.2243],[29.6518,48.9365],[29.9448,48.6568],[29.9863,48.6119],[30.0049,48.5721],[30.0204,48.5196],[30.0068,48.5134],[29.9672,48.4906],[30.0444,48.4822],[30.1649,48.5038],[30.387,48.5282],[30.5712,48.6064],[30.5551,48.6545],[30.6985,48.7667],[30.8849,48.7455],[31.1152,48.7283],[31.4122,48.756],[31.5821,48.8872],[31.806,48.9495],[31.9175,48.9071],[32.2189,48.9887],[32.2834,49.0856],[32.5009,49.0146],[32.5508,48.94],[32.582,48.9506],[32.6061,48.9639],[32.6805,48.957],[32.7302,48.9777],[32.7329,48.9655],[32.8423,49.0273],[32.8894,49.1203],[32.7653,49.2319],[32.5979,49.275],[32.4785,49.3414],[32.5102,49.4086],[32.6792,49.4267],[32.6723,49.4468],[32.7147,49.6192],[32.5735,49.7028],[32.3729,49.8744],[32.4278,49.9599],[32.1256,50.2247]]]}},{"type":"Feature","properties":{"name":"Чернівецька"},"geometry":{"type":"Polygon","coordinates":[[[25.8497,48.5976],[25.7827,48.6754],[25.7117,48.6635],[25.5841,48.6307],[25.601,48.4118],[25.3189,48.3684],[25.1077,48.2249],[25.0355,48.1117],[24.9117,48.0282],[24.918,47.9485],[24.997,47.8538],[24.9215,47.7262],[25.1669,47.7917],[25.2292,47.8923],[25.6251,47.9494],[26.1851,47.9944],[26.333,48.1845],[26.5721,48.2198],[26.8728,48.4198],[26.9318,48.363],[27.2857,48.3714],[27.5346,48.4702],[27.4793,48.5056],[27.4781,48.5506],[27.4441,48.6035],[27.3641,48.6309],[27.3157,48.5997],[27.2746,48.6248],[27.2461,48.6226],[27.2394,48.6075],[27.1665,48.5821],[27.0037,48.5692],[26.8251,48.6051],[26.7779,48.5939],[26.6748,48.5403],[26.6556,48.4859],[26.6269,48.4623],[26.3909,48.5344],[26.271,48.5394],[26.0967,48.5995],[26.0449,48.5848],[26.0327,48.643],[25.8497,48.5976]]]}},{"type":"Feature","properties":{"name":"Чернігівська"},"geometry":{"type":"Polygon","coordinates":[[[33.4289,52.3457],[33.1964,52.3738],[32.9043,52.2459],[32.378,52.3375],[32.2909,52.1031],[32.0958,52.0336],[31.8676,52.1106],[31.4298,52.1434],[31.254,52.0427],[31.1391,52.1033],[30.9243,52.0599],[30.6915,51.8353],[30.5102,51.597],[30.6542,51.3793],[30.5029,51.2258],[30.5024,51.0217],[30.641,51.0028],[30.835,50.7616],[30.8746,50.7771],[31.071,50.7642],[31.222,50.6835],[31.1882,50.5752],[31.4261,50.5015],[31.7815,50.5591],[31.8586,50.6306],[32.0448,50.4939],[31.9635,50.4859],[31.9784,50.4814],[32.024,50.4579],[32.0769,50.3745],[32.144,50.3485],[32.3291,50.4269],[32.5251,50.3452],[32.9179,50.4088],[33.0237,50.5013],[33.0491,50.5407],[33.1232,50.5945],[33.2005,50.9621],[33.0421,50.9914],[32.9446,51.0915],[33.07,51.2553],[33.1921,51.5068],[33.078,51.7752],[33.1242,51.863],[33.3951,51.9551],[33.3167,52.0314],[33.3571,52.2578],[33.3772,52.2763],[33.388,52.315],[33.4289,52.3457]]]}},{"type":"Feature","properties":{"name":"Херсонська"},"geometry":{"type":"Polygon","coordinates":[[[33.6076,47.5609],[33.5789,47.5989],[33.2791,47.5181],[33.1716,47.5668],[33.0929,47.5793],[33.0956,47.5276],[33.149,47.5147],[33.0332,47.4416],[33.0404,47.3802],[33.1306,47.2031],[32.917,47.1429],[33.0704,47.0209],[33.0236,46.9718],[32.6901,46.8628],[32.2506,46.8193],[31.9822,46.6565],[32.2438,46.5913],[32.321,46.4781],[31.8577,46.5167],[31.806,46.4787],[32.0656,46.3865],[31.9738,46.2558],[32.2377,46.1844],[32.2275,46.1317],[32.5425,46.0655],[32.7676,46.1225],[33.3305,46.116],[33.4158,46.0383],[33.6152,46.1346],[33.6143,46.226],[33.9677,46.2137],[34.0416,46.1202],[34.3802,46.198],[34.4805,46.1388],[34.4172,46.0184],[34.5881,46.009],[34.6444,46.0924],[34.8959,46.2394],[35.1038,46.302],[35.0536,46.4819],[34.7127,46.6196],[34.7578,46.8229],[34.7364,46.9611],[34.6234,46.9727],[34.5201,47.105],[34.4799,47.3145],[34.3301,47.2904],[34.1394,47.4768],[33.9352,47.5168],[33.6361,47.5129],[33.6076,47.5609]]]}},{"type":"Feature","properties":{"name":"Київська"},"geometry":{"type":"Polygon","coordinates":[[[30.5029,51.2258],[30.1787,51.5132],[29.8748,51.4436],[29.7387,51.5247],[29.5371,51.4812],[29.3935,51.3799],[29.3494,51.16],[29.5111,51.0605],[29.4131,50.9853],[29.5215,50.869],[29.5773,50.6998],[29.4977,50.5887],[29.5599,50.4232],[29.7003,50.2318],[29.6432,50.18],[29.7296,49.9686],[29.667,49.8746],[29.4384,49.8054],[29.4878,49.67],[29.5369,49.6359],[29.5051,49.395],[29.5356,49.3247],[29.7089,49.2626],[29.7546,49.2267],[29.877,49.2004],[30.0267,49.332],[30.3679,49.2557],[30.4123,49.3301],[30.6059,49.3708],[30.9092,49.3591],[31.0946,49.4978],[31.2209,49.7335],[31.2071,49.8498],[31.3808,49.9072],[31.716,49.8502],[31.9112,50.1015],[32.0868,50.2222],[32.0904,50.2467],[32.1304,50.316],[32.0769,50.3745],[32.024,50.4579],[31.9784,50.4814],[31.9635,50.4859],[32.0448,50.4939],[31.8586,50.6306],[31.7815,50.5591],[31.4261,50.5015],[31.1882,50.5752],[31.222,50.6835],[31.071,50.7642],[30.8746,50.7771],[30.835,50.7616],[30.641,51.0028],[30.5024,51.0217],[30.5029,51.2258]]]}}]};

// ===== Fallback constants (used when DB not available) =====
export const FALLBACK_OFFICES = {
    'Карпатська ЛО': { oblasts: ['Закарпатська', 'Івано-Франківська', 'Чернівецька', 'Львівська'], lat: 48.9, lng: 24.0 },
    'Південна ЛО': { oblasts: ['Одеська', 'Миколаївська', 'Херсонська'], lat: 47.0, lng: 32.5 },
    'Північна ЛО': { oblasts: ['Чернігівська'], lat: 51.5, lng: 31.3 },
    'Подільська ЛО': { oblasts: ['Вінницька', 'Хмельницька', 'Тернопільська'], lat: 49.2, lng: 27.5 },
    'Поліська ЛО': { oblasts: ['Волинська', 'Рівненська', 'Житомирська'], lat: 51.0, lng: 26.5 },
    'Слобожанська ЛО': { oblasts: ['Харківська', 'Сумська'], lat: 50.5, lng: 35.5 },
    'Столична ЛО': { oblasts: ['Київська'], lat: 50.4, lng: 30.5 },
    'Центральна ЛО': { oblasts: ['Черкаська', 'Кіровоградська', 'Полтавська'], lat: 49.0, lng: 33.0 },
    'Східна ЛО': { oblasts: ['Дніпропетровська', 'Запорізька', 'Донецька', 'Луганська'], lat: 48.0, lng: 36.0 }
};

// ===== Dynamic getters (read from state, fallback to constants) =====

/** Map of office name → [lat, lng] for label placement */
export function getOfficeCenters() {
    if (regionalOffices.length) {
        const map = {};
        for (const o of regionalOffices) {
            if (o.center_lat && o.center_lng) map[o.name] = [o.center_lat, o.center_lng];
        }
        return map;
    }
    // Fallback
    const map = {};
    for (const [name, d] of Object.entries(FALLBACK_OFFICES)) map[name] = [d.lat, d.lng];
    return map;
}

/** Map of oblast name → office name */
export function getOblastToOffice() {
    const map = {};
    if (regionalOffices.length) {
        for (const o of regionalOffices) {
            for (const ob of (o.oblasts || [])) map[ob] = o.name;
        }
    } else {
        for (const [name, d] of Object.entries(FALLBACK_OFFICES)) {
            for (const ob of d.oblasts) map[ob] = name;
        }
    }
    return map;
}

/** Map of branch name or alias → office name (for forest data matching) */
export function getBranchToOffice() {
    const map = {};
    if (regionalOffices.length) {
        for (const o of regionalOffices) {
            map[o.name] = o.name;
            for (const alias of (o.branch_aliases || [])) map[alias] = o.name;
        }
    } else {
        for (const name of Object.keys(FALLBACK_OFFICES)) map[name] = name;
    }
    return map;
}

/** Fuzzy match: strip ОУЛ/ЛО suffixes and compare stems */
export function fuzzyMatchBranch(branchName) {
    if (!branchName) return null;
    const branchMap = getBranchToOffice();
    if (branchMap[branchName]) return branchMap[branchName];
    const norm = branchName.replace(/\s*(ОУЛ|ЛО|обласне управління лісами)\s*$/i, '').trim().toLowerCase();
    for (const [alias, office] of Object.entries(branchMap)) {
        const normAlias = alias.replace(/\s*(ОУЛ|ЛО|обласне управління лісами)\s*$/i, '').trim().toLowerCase();
        if (normAlias === norm) return office;
        // Partial stem match (Поліськ → Поліська)
        if (norm.length > 3 && normAlias.length > 3) {
            const stem = norm.substring(0, Math.min(norm.length, normAlias.length) - 1);
            if (normAlias.startsWith(stem) || norm.startsWith(normAlias.substring(0, normAlias.length - 1))) return office;
        }
    }
    return null;
}

/** Get all oblasts for a given office name */
export function getOfficeOblasts(officeName) {
    if (regionalOffices.length) {
        const o = regionalOffices.find(r => r.name === officeName);
        return o ? (o.oblasts || []) : [];
    }
    return FALLBACK_OFFICES[officeName]?.oblasts || [];
}

// ===== Oblast-level GeoJSON with office annotation =====

/** Returns GeoJSON with each feature annotated with its parent office name */
export function getOblastsGeoJSON() {
    const oblastToOffice = getOblastToOffice();
    return {
        type: 'FeatureCollection',
        features: OBLASTS_RAW.features.map(f => ({
            ...f,
            properties: {
                ...f.properties,
                office: oblastToOffice[f.properties.name] || null
            }
        }))
    };
}

// ===== Static GeoJSON — 9 regional office polygons (used for ЛО border overlay) =====
export const OFFICES_GEOJSON = {
    type: 'FeatureCollection',
    features: [
        {
            type: 'Feature',
            properties: { name: 'Карпатська ЛО' },
            geometry: {
                type: 'Polygon',
                coordinates: [[[22.15,48.1],[22.15,49.0],[22.5,49.6],[23.2,50.4],[24.0,50.2],[25.0,49.9],[25.5,49.4],[25.8,48.8],[26.0,48.1],[25.3,47.9],[24.5,47.7],[23.5,47.9],[22.15,48.1]]]
            }
        },
        {
            type: 'Feature',
            properties: { name: 'Подільська ЛО' },
            geometry: {
                type: 'Polygon',
                coordinates: [[[25.0,49.9],[25.5,50.4],[26.5,50.5],[27.5,50.8],[28.5,50.6],[29.0,50.0],[29.0,49.2],[28.5,48.4],[27.0,48.2],[26.0,48.1],[25.8,48.8],[25.5,49.4],[25.0,49.9]]]
            }
        },
        {
            type: 'Feature',
            properties: { name: 'Поліська ЛО' },
            geometry: {
                type: 'Polygon',
                coordinates: [[[23.6,50.5],[24.0,51.6],[25.5,51.9],[27.0,51.9],[28.5,51.8],[29.5,51.5],[30.0,51.0],[29.5,50.5],[28.5,50.6],[27.5,50.8],[26.5,50.5],[25.5,50.4],[24.0,50.2],[23.6,50.5]]]
            }
        },
        {
            type: 'Feature',
            properties: { name: 'Столична ЛО' },
            geometry: {
                type: 'Polygon',
                coordinates: [[[29.5,50.5],[30.0,51.0],[31.0,51.5],[32.0,51.3],[32.5,50.8],[32.0,50.0],[31.0,49.6],[30.0,49.8],[29.0,50.0],[29.5,50.5]]]
            }
        },
        {
            type: 'Feature',
            properties: { name: 'Північна ЛО' },
            geometry: {
                type: 'Polygon',
                coordinates: [[[31.0,51.5],[31.5,52.3],[32.5,52.4],[33.5,52.3],[34.5,52.0],[34.0,51.2],[33.5,50.8],[32.5,50.8],[32.0,51.3],[31.0,51.5]]]
            }
        },
        {
            type: 'Feature',
            properties: { name: 'Слобожанська ЛО' },
            geometry: {
                type: 'Polygon',
                coordinates: [[[34.0,51.2],[34.5,52.0],[35.5,52.0],[37.0,51.5],[38.0,51.0],[38.5,50.5],[38.0,49.5],[37.0,49.0],[36.0,49.2],[35.0,49.8],[34.0,50.2],[33.5,50.8],[34.0,51.2]]]
            }
        },
        {
            type: 'Feature',
            properties: { name: 'Центральна ЛО' },
            geometry: {
                type: 'Polygon',
                coordinates: [[[31.0,49.6],[32.0,50.0],[33.5,50.8],[34.0,50.2],[35.0,49.8],[35.5,49.0],[35.0,48.2],[34.0,48.0],[33.0,48.0],[32.0,48.3],[31.0,48.8],[30.0,49.0],[29.0,49.2],[29.0,50.0],[30.0,49.8],[31.0,49.6]]]
            }
        },
        {
            type: 'Feature',
            properties: { name: 'Південна ЛО' },
            geometry: {
                type: 'Polygon',
                coordinates: [[[29.0,47.0],[28.5,47.5],[28.5,48.4],[29.0,49.2],[30.0,49.0],[31.0,48.8],[32.0,48.3],[33.0,48.0],[34.0,48.0],[34.5,47.5],[34.0,46.5],[33.0,46.0],[31.5,46.2],[30.0,46.5],[29.0,47.0]]]
            }
        },
        {
            type: 'Feature',
            properties: { name: 'Східна ЛО' },
            geometry: {
                type: 'Polygon',
                coordinates: [[[35.0,48.2],[35.5,49.0],[36.0,49.2],[37.0,49.0],[38.0,49.5],[38.5,49.0],[39.5,48.5],[39.5,47.5],[38.5,47.0],[37.5,46.8],[36.5,47.0],[35.5,47.5],[34.5,47.5],[34.0,48.0],[35.0,48.2]]]
            }
        }
    ]
};
